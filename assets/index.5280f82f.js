var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,a=(e,t)=>{for(var i in t||(t={}))n.call(t,i)&&l(e,i,t[i]);if(s)for(var i of s(t))o.call(t,i)&&l(e,i,t[i]);return e};import{o as r,c as u,a as d,r as c,b as p,t as m,w as h,d as b,v as g,e as f,f as y}from"./vendor.8e034b20.js";const v={props:{name:{type:String,default:"fa fa-user"},size:{type:Number,default:32},border:{type:Boolean}},computed:{className(){return`mdi mdi-${this.name}`}},style({className:e}){const{size:s,border:n}=this;return[e("icon",(o=a({display:"inline-block",width:`${s}px`,height:`${s}px`,lineHeight:`${s}px`,textAlign:"center",border:"solid 2px"},n?{borderRadius:`${s}px`,background:"rgba(0, 0, 0, 0.1)"}:{borderColor:"transparent"}),l={"& > span":{fontSize:s/1.9+"px",lineHeight:0,"&:before":{verticalAlign:"middle"}}},t(o,i(l))))];var o,l}};v.render=function(e,t,i,s,n,o){return r(),u("div",{class:e.$style.icon},[d("span",{class:o.className},null,2)],2)};const x={components:{Icon:v},props:{subtitle:{type:File,default:null},movie:{type:File,default:null}},emits:["update:subtitle","update:movie","done"],data:()=>({files:Object.freeze([])}),computed:{movieFile(){return this.files.find((e=>e.name.endsWith(".mp4")||e.name.endsWith(".mkv")))},subtitleFile(){const e=this.files.find((e=>e.name.endsWith(".srt")||e.name.endsWith(".vtt")));return e&&e.name.endsWith(".vtt")?e:this.files.find((e=>e.name.endsWith(".srt")))},readyToDone(){return this.movieFile&&this.subtitleFile}},watch:{movieFile(e){this.$emit("update:movie",e)},subtitleFile(e){this.$emit("update:subtitle",e)},readyToDone(){this.$emit("done")}},methods:{openFileSelectorDialog(){this.$refs.file.click()},onFileSelect(e){this.addFiles([...e.target.files])},onDrop(e){this.addFiles([...e.dataTransfer.files])},async addFiles(e){const t=e.filter((e=>"text/vtt"===e.type)),i=e.filter((e=>["video/x-matroska","video/mp4"].includes(e.type))),s=e.filter((e=>"application/x-subrip"===e.type));t.push(...(await Promise.all(s.map((e=>(e=>new Promise(((t,i)=>{const s=new FileReader;s.readAsText(e),s.onloadend=e=>t(e.target.result),s.onerror=e=>i(e)})))(e))))).map(((e,t)=>((e,t)=>{const i=new Blob([`WEBVTT\n\n${t.split("\n").map((e=>e.match(/^\d+:\d+:\d+,\d+\s-->\s\d+:\d+:\d+,\d+/gm)?e.split(",").join("."):e)).join("\n")}`],{type:"text/vtt"});return new File([i],e,{type:"text/vtt"})})(s[t].name,e)))),this.files=Object.freeze([...t,...i,...this.files])}},style:({className:e})=>[e("filesSelector",{background:"white",padding:"16px",'& > input[type="file"]':{display:"none"}})]};x.render=function(e,t,i,s,n,o){const l=c("Icon");return r(),u("div",{class:e.$style.filesSelector,onDragover:t[2]||(t[2]=h((()=>{}),["prevent"])),onDrop:t[3]||(t[3]=h(((...e)=>o.onDrop&&o.onDrop(...e)),["prevent"])),onClick:t[4]||(t[4]=(...e)=>o.openFileSelectorDialog&&o.openFileSelectorDialog(...e))},[d("input",{ref:"file",type:"file",onInput:t[1]||(t[1]=(...e)=>o.onFileSelect&&o.onFileSelect(...e))},null,544),d("div",null,[d(l,{size:48,name:"movie-outline"}),p(" "+m(o.movieFile?o.movieFile.name:"---"),1)]),d("div",null,[d(l,{size:48,name:"subtitles-outline"}),p(" "+m(o.subtitleFile?o.subtitleFile.name:"---"),1)])],34)};const C={props:{activeCues:{type:Array,default:()=>[]}},emits:["select"],data:()=>({selectedText:null,translatedText:null}),computed:{parsedContent(){const e=this.activeCues.map((e=>e.text)).join("\n");return/\w/g.test(e)?e.replace(/<[^>]+>/g,""):""}},watch:{parsedContent(){this.selectedText=null},selectedText(e){var t;e?(this.translatedText="...",(t=e,Promise.resolve(t)).then((e=>{this.translatedText=e}))):this.translatedText=null}},methods:{onMouseUp(e){if(this.translatedText=null,this.selectedText=null,3===e.which){const e=window.getSelection().toString().trim();this.selectedText=e,this.$emit("select",e)}}},style:({className:e})=>[e("subtitle",{width:"100%",height:"auto",display:"flex",flexDirection:"column",alignItems:"center","&:empty, & *:empty":{display:"none"},"& > *":{whiteSpace:"pre-line",padding:"15px",width:"auto",textShadow:"0 1px #000",lineHeight:"2.5rem",fontSize:"1.8rem",fontWeight:"bold",textAlign:"center"},"& > .translated":{background:"rgba(0, 0, 0, 0.4)",color:"#3eff3d"},"& > .content":{background:"rgba(0, 0, 0, 0.4)",color:"#fff","&, & *":{userSelect:"text"},"& > div":{lineHeight:1.6}}})]};C.render=function(e,t,i,s,n,o){return b((r(),u("div",{class:e.$style.subtitle,onMouseup:t[1]||(t[1]=(...e)=>o.onMouseUp&&o.onMouseUp(...e))},[d("div",{class:"translated",textContent:m(n.translatedText)},null,8,["textContent"]),d("div",{class:"content",textContent:m(o.parsedContent)},null,8,["textContent"])],34)),[[g,o.parsedContent]])};const T={props:{value:{type:Number,default:0},length:{type:Number,default:0},disabled:{type:Boolean}},emits:["input"],computed:{progressStyle(){return{transform:`translateX(${-1*(100-this.value/this.length*100)}%)`}}},methods:{onMouseUp(e){if(this.disabled)return;const t=e.x/e.currentTarget.offsetWidth*this.length;this.$emit("input",t)}},style:({className:e})=>[e("range",{height:"18px",width:"100%",cursor:"pointer",position:"relative","&:hover":{"& > .content":{height:"18px"}},"& > .content":{background:"rgba(255, 255, 255, 0.1)",height:"4px",left:0,width:"100%",position:"absolute",bottom:0,overflow:"hidden","& > .progress":{transform:"translateX(-100%)",background:"#ff0000",height:"100%",left:0,position:"absolute",boxShadow:"3px 0 2px #000",width:"100%"}}})]},k={class:"content"};T.render=function(e,t,i,s,n,o){return r(),u("div",{class:e.$style.range,onMouseup:t[1]||(t[1]=(...e)=>o.onMouseUp&&o.onMouseUp(...e))},[d("div",k,[d("div",{class:"progress",style:o.progressStyle},null,4)])],34)};const w={components:{Range:T,Icon:v},props:{allCues:{type:Array,default:()=>[]},activeCues:{type:Array,default:()=>[]},isPaused:{type:Boolean},currentTime:{type:Number,default:0},duration:{type:Number,default:0}},emits:["togglePlay","updateTime"],data:()=>({lockedCues:[]}),computed:{formattedCurrentTime(){return Math.floor(this.currentTime).toString().padStart(4,0)},formattedDuration(){return Math.floor(this.duration).toString().padStart(4,0)}},watch:{currentTime(e){if(this.lockedCues.length){const t=Math.max(...this.lockedCues.map((e=>e.startTime))),i=Math.min(...this.lockedCues.map((e=>e.endTime)));e+1>=i&&setTimeout((()=>{this.$emit("updateTime",t)}),1e3*(i-e-.1))}}},methods:{togglePlay(){this.$emit("togglePlay")},nextCue(){const e=this.allCues.find((e=>e.startTime>=this.currentTime));e&&this.$emit("updateTime",e.startTime)},prevCue(){const e=this.allCues.findIndex((e=>e.startTime>=this.currentTime));e>0&&this.$emit("updateTime",this.allCues[e-1].startTime)},toggleLock(){this.activeCues.length&&(this.lockedCues=this.lockedCues.length?[]:this.activeCues)},updateTime(e){this.$emit("updateTime",e)}},style:({className:e})=>[e("controls",{width:"100%",height:"auto",display:"flex",flexDirection:"column",alignItems:"center",color:"#fff","& > .buttons":{display:"flex",flexDirection:"row",justifyContent:"center","& > button":{margin:"0 8px",cursor:"pointer",borderRadius:"8px","&:not(:disabled):hover":{background:"rgba(255, 255, 255, 0.1)"},"&:disabled":{cursor:"not-allowed",opacity:.4}}},"& > .progress":{display:"flex",flexDirection:"row",justifyContent:"center",marginTop:"20px",width:"100%","& > input":{flexGrow:1,background:"transparent",margin:"0 8px"}}})]},S={class:"buttons"},P={class:"progress"};w.render=function(e,t,i,s,n,o){const l=c("Icon"),a=c("Range");return r(),u("div",{class:e.$style.controls},[d("div",S,[d("button",{disabled:!!n.lockedCues.length,onClick:t[1]||(t[1]=(...e)=>o.prevCue&&o.prevCue(...e))},[d(l,{size:48,name:"skip-previous"})],8,["disabled"]),d("button",{disabled:!!n.lockedCues.length,onClick:t[2]||(t[2]=(...e)=>o.togglePlay&&o.togglePlay(...e))},[d(l,{size:48,name:i.isPaused?"play":"pause"},null,8,["name"])],8,["disabled"]),d("button",{disabled:!i.activeCues.length,onClick:t[3]||(t[3]=(...e)=>o.toggleLock&&o.toggleLock(...e))},[d(l,{size:48,name:"lock-reset"})],8,["disabled"]),d("button",{disabled:!!n.lockedCues.length,onClick:t[4]||(t[4]=(...e)=>o.nextCue&&o.nextCue(...e))},[d(l,{size:48,name:"skip-next"})],8,["disabled"])]),d("div",P,[d(a,{disabled:!!n.lockedCues.length,length:10*i.duration,value:10*i.currentTime,onInput:t[5]||(t[5]=e=>o.updateTime(e/10))},null,8,["disabled","length","value"])])],2)};const $={components:{Subtitle:C,Controls:w},props:{movie:{type:File,required:!0},subtitle:{type:File,required:!0}},data:()=>({allCues:[],activeCues:[],isPaused:!1,currentTime:0,duration:0}),computed:{movieSrc(){return URL.createObjectURL(this.movie)},subtitleSrc(){return URL.createObjectURL(this.subtitle)}},methods:{onSubtitleTrackLoad(e){this.allCues=Object.freeze([...e.target.track.cues])},onCueChange(e){const t=Object.freeze([...e.target.track.activeCues]);this.activeCues=t},onTimeUpdate(e){this.currentTime=e.target.currentTime},onPlay(){const{player:e}=this.$refs;this.duration=e.duration,this.isPaused=!1},onPause(){this.isPaused=!0},togglePlay(){const{player:e}=this.$refs;e.paused?e.play():e.pause()},updateTime(e){const{player:t}=this.$refs;t.currentTime=e}},style:({className:e})=>[e("player",{width:"100%",height:"100%",maxHeight:"100%",background:"#000","&::cue":{opacity:0}}),e("subtitle",{position:"absolute",bottom:"120px"}),e("controls",{position:"absolute",bottom:0})]};$.render=function(e,t,i,s,n,o){const l=c("Subtitle"),a=c("Controls");return r(),u("div",null,[d("video",{ref:"player",class:e.$style.player,autoplay:"",onPlay:t[3]||(t[3]=(...e)=>o.onPlay&&o.onPlay(...e)),onPause:t[4]||(t[4]=(...e)=>o.onPause&&o.onPause(...e)),onTimeupdate:t[5]||(t[5]=(...e)=>o.onTimeUpdate&&o.onTimeUpdate(...e))},[d("source",{src:o.movieSrc,type:"video/mp4"},null,8,["src"]),d("track",{ref:"subtitleTrack",kind:"subtitles",label:"Subtitle",default:"",src:o.subtitleSrc,onLoad:t[1]||(t[1]=(...e)=>o.onSubtitleTrackLoad&&o.onSubtitleTrackLoad(...e)),onCuechange:t[2]||(t[2]=(...e)=>o.onCueChange&&o.onCueChange(...e))},null,40,["src"])],34),d(l,{class:e.$style.subtitle,"active-cues":n.activeCues},null,8,["class","active-cues"]),d(a,{class:e.$style.controls,"all-cues":n.allCues,"active-cues":n.activeCues,"is-paused":n.isPaused,"current-time":n.currentTime,duration:n.duration,onTogglePlay:o.togglePlay,onUpdateTime:o.updateTime},null,8,["class","all-cues","active-cues","is-paused","current-time","duration","onTogglePlay","onUpdateTime"])])};const F={components:{FilesSelector:x,Player:$},data:()=>({movie:null,subtitle:null,isPlaying:!1}),methods:{play(){this.isPlaying=!0}},style:({className:e})=>[e("home",{width:"100%",height:"100%",maxHeight:"100%"})]};F.render=function(e,t,i,s,n,o){const l=c("FilesSelector"),a=c("Player");return n.isPlaying?(r(),u(a,{key:1,class:e.$style.home,movie:n.movie,subtitle:n.subtitle},null,8,["class","movie","subtitle"])):(r(),u(l,{key:0,movie:n.movie,"onUpdate:movie":t[1]||(t[1]=e=>n.movie=e),subtitle:n.subtitle,"onUpdate:subtitle":t[2]||(t[2]=e=>n.subtitle=e),class:e.$style.home,onDone:o.play},null,8,["movie","subtitle","class","onDone"]))};const D={components:{Home:F},data:()=>({title:void 0}),style:({className:e,custom:t})=>[e("app",{width:"100%",height:"100%",overflow:"hidden"}),t("html, body, #app",{fontFamily:"sans-serif",width:"100%",height:"100%",minHeight:"100%",maxWidth:"100%"}),t("*, *:after, &:before",{bixSizing:"content-box",touchAction:"none !important"}),t("*",{touchAction:"none !important",userSelect:"none",fontFamily:"inherit",padding:0,margin:0,listStyle:"none",borderStyle:"solid",borderWidth:"0px",verticalAlign:"baseline",backfaceVisibility:"hidden",color:"inherit",borderColor:"inherit",backgroundColor:"transparent",borderSpacing:0,font:"unset","-webkitOverflowScrolling":"touch","-webkitTapHighlightColor":"rgba(0, 0, 0, 0)",boxSizing:"border-box","&::-moz-focus-inner":{border:0},"&:focus":{outline:"none"}}),t("a, a:hover, a:visited",{textDecoration:"none"})]};D.render=function(e,t,i,s,n,o){const l=c("Home");return r(),u("div",{class:e.$style.app},[d(l)],2)};window.$app=f(D).use(y).mount("#app");
