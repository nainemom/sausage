import{o as e,c as t,a as i,r as n,t as s,w as a,b as o,d as l,v as r,e as u,F as d,f as c,g as p}from"./vendor.dbfc7d7c.js";const m={props:{name:{type:String,default:"fa fa-user"},size:{type:Number,default:32}},computed:{className(){return`mdi mdi-${this.name}`}},style({className:e}){const{size:t}=this;return[e("icon",{display:"inline-block",width:`${t}px`,height:`${t}px`,lineHeight:`${t}px`,textAlign:"center","& > span":{fontSize:`${t}px`,lineHeight:`${t}px`,verticalAlign:"middle","&:before":{verticalAlign:"baseline"}}})]}};m.render=function(n,s,a,o,l,r){return e(),t("div",{class:n.$style.icon},[i("span",{class:r.className},null,2)],2)};var g={emits:["update:subtitle","update:movie"],props:{subtitle:{type:File,default:null},movie:{type:File,default:null}},methods:{setFilesConfigProp(e,t){this.$emit(`update:${e}`,t)}}};const h=e=>{try{return JSON.parse(localStorage.getItem(`config:${e}`))}catch{return null}};var b={emits:["update:subtitleLang","update:primaryLang","update:translatorService"],props:{subtitleLang:{type:String,default:h("subtitleLang")},primaryLang:{type:String,default:h("primaryLang")},translatorService:{type:String,default:h("translatorService")}},methods:{setSubtitleConfigProp(e,t){localStorage.setItem(`config:${e}`,JSON.stringify(t)),this.$emit(`update:${e}`,t)}}};const f={components:{Icon:m},mixins:[g,b],props:{subtitle:{type:File,default:null},movie:{type:File,default:null},subtitleLang:{type:String,default:null},primaryLang:{type:String,default:null},translatorService:{type:String,default:null}},emits:["done"],data:()=>({files:Object.freeze([]),dragEnter:!1}),computed:{movieFile(){return this.files.find((e=>e.name.endsWith(".mp4")||e.name.endsWith(".mkv")))},subtitleFile(){const e=this.files.find((e=>e.name.endsWith(".srt")||e.name.endsWith(".vtt")));return e&&e.name.endsWith(".vtt")?e:this.files.find((e=>e.name.endsWith(".srt")))},miniFileNames(){const e=e=>e.length>19?`${e.substr(0,8)}...${e.substr(-8)}`:e;return{movie:this.movieFile?e(this.movieFile.name):null,subtitle:this.subtitleFile?e(this.subtitleFile.name):null}},isReadyToDone(){return this.movieFile&&this.subtitleFile}},watch:{movieFile(e){this.setFilesConfigProp("movie",e)},subtitleFile(e){this.setFilesConfigProp("subtitle",e)}},created(){this.primaryLang||this.setSubtitleConfigProp("primaryLang","fa"),this.subtitleLang||this.setSubtitleConfigProp("subtitleLang","en"),this.translatorService||this.setSubtitleConfigProp("translatorService","google")},methods:{openFileSelectorDialog(){this.$refs.file.click()},onFileSelect(e){this.addFiles([...e.target.files])},onDragEnter(){this.dragEnter=!0},onDragLeave(e){e.clientX||e.clientY||(this.dragEnter=!1)},onDrop(e){this.dragEnter=!1,this.addFiles([...e.dataTransfer.files])},async addFiles(e){const t=e.filter((e=>"text/vtt"===e.type)),i=e.filter((e=>["video/x-matroska","video/mp4"].includes(e.type))),n=e.filter((e=>"application/x-subrip"===e.type));t.push(...(await Promise.all(n.map((e=>(e=>new Promise(((t,i)=>{const n=new FileReader;n.readAsText(e),n.onloadend=e=>t(e.target.result),n.onerror=e=>i(e)})))(e))))).map(((e,t)=>((e,t)=>{const i=new Blob([`WEBVTT\n\n${t.split("\n").map((e=>e.match(/^\d+:\d+:\d+,\d+\s-->\s\d+:\d+:\d+,\d+/gm)?e.split(",").join("."):e)).join("\n")}`],{type:"text/vtt"});return new File([i],e,{type:"text/vtt"})})(n[t].name,e)))),this.files=Object.freeze([...t,...i,...this.files])},done(){this.isReadyToDone&&this.$emit("done")}},style:({className:e})=>[e("setupForm",{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1rem",background:"#eee",'& input[type="file"]':{display:"none"},"& button, & input, & select":{border:"solid 1px #ccc",height:"36px",padding:"0 12px",lineHeight:"36px",appearance:"none"},"& button":{cursor:"pointer","&:not(:disabled):hover, &:not(:disabled):focus":{background:"rgba(0, 0, 0, 0.05)"},"&:not(:disabled):active":{background:"rgba(0, 0, 0, 0.1)"},"&:disabled":{cursor:"not-allowed",color:"#888"}},"& select":{cursor:"pointer","&:not(:disabled):hover, &:not(:disabled):focus":{background:"rgba(0, 0, 0, 0.05)"}},"& input":{width:"76px"},"& > .form":{background:"#fff",border:"solid 1px #ccc",overflow:"hidden",minWidth:"360px",padding:"16px 0",position:"relative","&.drag-enter":{border:"dotted 2px #ccc","& > *:not(.drag-enter-text)":{visibility:"hidden"},"& > .drag-enter-text":{fontSize:"1.4rem",display:"block",width:"100%",textAlign:"center",position:"absolute",color:"#333",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}},"& > .drag-enter-text":{display:"none"},"& > .line":{height:"1px",background:"#ccc",marginBottom:"16px"},"& > .form-element":{display:"flex",flexDirection:"row",alignItems:"center",padding:"0 16px","&:not(:last-child)":{marginBottom:"16px"},"& > .title":{color:"#555",flexGrow:1},"& > .content":{paddingLeft:"16px"}}}})]},v={class:"form-element"},y={class:"title"},x=o(" Video File: "),C={class:"content"},S={class:"form-element"},T={class:"title"},w=o(" Subtitle File: "),k={class:"content"},$={class:"form-element"},L={class:"title"},P=o(" Subtitle Language: "),F={class:"content"},D={class:"form-element"},z={class:"title"},N=o(" My Primary Language: "),I={class:"content"},U={class:"form-element"},j={class:"title"},H=o(" Translator Service: "),M={class:"content"},A=i("option",{value:"google"}," Google ",-1),W=i("option",{value:"bing"}," Bing ",-1),B=i("div",{class:"line"},null,-1),E={class:"form-element"},O=i("div",{class:"title"},null,-1),R={class:"content"},G=o(" Play "),V=i("div",{class:"drag-enter-text"}," Drop Files Here ",-1);f.render=function(o,l,r,u,d,c){const p=n("Icon");return e(),t("div",{class:o.$style.setupForm,onDragover:l[8]||(l[8]=a((()=>{}),["prevent"])),onDragenter:l[9]||(l[9]=(...e)=>c.onDragEnter&&c.onDragEnter(...e)),onDragleave:l[10]||(l[10]=(...e)=>c.onDragLeave&&c.onDragLeave(...e)),onDrop:l[11]||(l[11]=a(((...e)=>c.onDrop&&c.onDrop(...e)),["prevent"]))},[i("div",{class:["form",[d.dragEnter&&"drag-enter"]]},[i("input",{ref:"file",type:"file",onInput:l[1]||(l[1]=(...e)=>c.onFileSelect&&c.onFileSelect(...e))},null,544),i("div",v,[i("div",y,[i(p,{size:22,name:"movie-outline"}),x]),i("div",C,[i("button",{onClick:l[2]||(l[2]=(...e)=>c.openFileSelectorDialog&&c.openFileSelectorDialog(...e))},s(c.movieFile?c.miniFileNames.movie:"Browse..."),1)])]),i("div",S,[i("div",T,[i(p,{size:22,name:"subtitles-outline"}),w]),i("div",k,[i("button",{onClick:l[3]||(l[3]=(...e)=>c.openFileSelectorDialog&&c.openFileSelectorDialog(...e))},s(c.subtitleFile?c.miniFileNames.subtitle:"Browse..."),1)])]),i("div",$,[i("div",L,[i(p,{size:22,name:"web"}),P]),i("div",F,[i("input",{value:r.subtitleLang,onInput:l[4]||(l[4]=e=>o.setSubtitleConfigProp("subtitleLang",e.target.value))},null,40,["value"])])]),i("div",D,[i("div",z,[i(p,{size:22,name:"account-voice"}),N]),i("div",I,[i("input",{value:r.primaryLang,onInput:l[5]||(l[5]=e=>o.setSubtitleConfigProp("primaryLang",e.target.value))},null,40,["value"])])]),i("div",U,[i("div",j,[i(p,{size:22,name:"translate"}),H]),i("div",M,[i("select",{value:r.translatorService,onInput:l[6]||(l[6]=e=>o.setSubtitleConfigProp("translatorService",e.target.value))},[A,W],40,["value"])])]),B,i("div",E,[O,i("div",R,[i("button",{disabled:!c.isReadyToDone,onClick:l[7]||(l[7]=(...e)=>c.done&&c.done(...e))},[i(p,{size:22,name:"play"}),G],8,["disabled"])])]),V],2)],34)};const X={mixins:[b],props:{activeCues:{type:Array,default:()=>[]}},emits:["select"],data:()=>({selectedText:"",translatorTab:null}),computed:{parsedContent(){const e=this.activeCues.map((e=>e.text)).join("\n");return/\w/g.test(e)?e.replace(/<[^>]+>/g,"").split("\n").map((e=>e.split(" ").map((e=>`<span>${e}</span>`)).join(" "))).join("\n"):""}},watch:{parsedContent(){this.selectedText=""}},methods:{onContextMenu(){const e=window.getSelection().toString().trim();this.selectedText=e,this.translate(this.selectedText),this.$emit("select",e)},translate(e){let t;t="google"===this.translatorService?`https://translate.google.com/?op=translate&sl=${this.subtitleLang}&tl=${this.primaryLang}&text=${encodeURI(e)}`:`https://bing.com/translator?from=${this.subtitleLang}&to=${this.primaryLang}&text=${e.split(" ").join("+")}`,window.translatorTab&&!window.translatorTab.closed||(window.translatorTab=window.open("","Translate","width=480,height=600,menubar=off,location=off,resizable=off,scrollbars=off,status=off")),window.translatorTab.location=t,window.translatorTab.focus()}},style:({className:e})=>[e("subtitle",{width:"100%",height:"auto",display:"flex",flexDirection:"column",alignItems:"center","&:empty, & *:empty":{display:"none"},"& > *":{whiteSpace:"pre-line",padding:"15px",width:"auto",textShadow:"0 1px #000",lineHeight:"2.5rem",fontSize:"1.8rem",fontWeight:"bold",textAlign:"center"},"& > .translated":{background:"rgba(0, 0, 0, 0.4)",color:"#3eff3d"},"& > .content":{background:"rgba(0, 0, 0, 0.4)",color:"#fff","&, & *":{userSelect:"text"},"& > div":{lineHeight:1.6}}})]};X.render=function(n,s,o,u,d,c){return l((e(),t("div",{class:n.$style.subtitle,onContextmenu:s[1]||(s[1]=a(((...e)=>c.onContextMenu&&c.onContextMenu(...e)),["prevent"]))},[i("div",{class:"content",innerHTML:c.parsedContent},null,8,["innerHTML"])],34)),[[r,c.parsedContent]])};const J={props:{value:{type:Number,default:0},length:{type:Number,default:0},disabled:{type:Boolean}},emits:["input"],computed:{progressStyle(){return{transform:`translateX(${-1*(100-this.value/this.length*100)}%)`}}},methods:{onMouseUp(e){if(this.disabled)return;const t=e.x/e.currentTarget.offsetWidth*this.length;this.$emit("input",t)}},style:({className:e})=>[e("seek",{height:"20px",width:"100%",cursor:"pointer",position:"relative","&:hover":{"& > .content":{height:"20px"}},"& > .content":{background:"rgba(255, 255, 255, 0.1)",height:"4px",transition:"height 0.1s",left:0,width:"100%",position:"absolute",bottom:0,overflow:"hidden","& > .progress":{transform:"translateX(-100%)",background:"#ff0000",height:"100%",left:0,position:"absolute",boxShadow:"3px 0 2px #000",width:"100%"}}})]},Y={class:"content"};J.render=function(n,s,a,o,l,r){return e(),t("div",{class:n.$style.seek,onMouseup:s[1]||(s[1]=(...e)=>r.onMouseUp&&r.onMouseUp(...e))},[i("div",Y,[i("div",{class:"progress",style:r.progressStyle},null,4)])],34)};const q={components:{Seek:J,Icon:m},props:{allCues:{type:Array,default:()=>[]},activeCues:{type:Array,default:()=>[]},isPaused:{type:Boolean},currentTime:{type:Number,default:0},duration:{type:Number,default:0}},emits:["togglePlay","updateTime","stop"],data:()=>({lockedCues:[]}),computed:{formattedCurrentTime(){return Math.floor(this.currentTime).toString().padStart(4,0)},formattedDuration(){return Math.floor(this.duration).toString().padStart(4,0)}},watch:{currentTime(e){if(this.lockedCues.length){const t=Math.max(...this.lockedCues.map((e=>e.startTime))),i=Math.min(...this.lockedCues.map((e=>e.endTime)));e+1>=i&&setTimeout((()=>{this.$emit("updateTime",t)}),1e3*(i-e-.1))}}},methods:{togglePlay(){this.$emit("togglePlay")},nextCue(){const e=this.allCues.find((e=>e.startTime>=this.currentTime));e&&this.$emit("updateTime",e.startTime)},prevCue(){const e=this.allCues.findIndex((e=>e.startTime>=this.currentTime));e>0&&this.allCues[e-2]&&this.$emit("updateTime",this.allCues[e-2].startTime)},toggleLock(){this.activeCues.length&&(this.lockedCues=this.lockedCues.length?[]:this.activeCues)},updateTime(e){this.$emit("updateTime",e)},stop(){this.$emit("stop")}},style:({className:e})=>[e("controls",{width:"100%",height:"auto",display:"flex",flexDirection:"column",alignItems:"center",color:"#fff","& > .buttons":{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center","& > .line":{width:"2px",height:"30px",background:"#333",margin:"0 6px"},"& > button":{margin:"0 4px",cursor:"pointer",padding:"8px","&:not(:disabled):hover":{background:"rgba(255, 255, 255, 0.1)"},"&:disabled":{cursor:"not-allowed",opacity:.4}}},"& > .progress":{display:"flex",flexDirection:"row",justifyContent:"center",marginTop:"20px",width:"100%","& > input":{flexGrow:1,background:"transparent",margin:"0 8px"}}})]},K={class:"buttons"},Q=i("div",{class:"line"},null,-1),Z={class:"progress"};q.render=function(s,a,o,l,r,u){const d=n("Icon"),c=n("Seek");return e(),t("div",{class:s.$style.controls},[i("div",K,[i("button",{disabled:!!r.lockedCues.length,onClick:a[1]||(a[1]=(...e)=>u.prevCue&&u.prevCue(...e))},[i(d,{size:42,name:"arrow-left"})],8,["disabled"]),i("button",{disabled:!!r.lockedCues.length,onClick:a[2]||(a[2]=(...e)=>u.togglePlay&&u.togglePlay(...e))},[i(d,{size:42,name:o.isPaused?"play":"pause"},null,8,["name"])],8,["disabled"]),i("button",{disabled:!o.activeCues.length,onClick:a[3]||(a[3]=(...e)=>u.toggleLock&&u.toggleLock(...e))},[i(d,{size:42,name:"lock-reset"})],8,["disabled"]),i("button",{disabled:!!r.lockedCues.length,onClick:a[4]||(a[4]=(...e)=>u.nextCue&&u.nextCue(...e))},[i(d,{size:42,name:"arrow-right"})],8,["disabled"]),Q,i("button",{onClick:a[5]||(a[5]=(...e)=>u.stop&&u.stop(...e))},[i(d,{size:42,name:"close"})])]),i("div",Z,[i(c,{disabled:!!r.lockedCues.length,length:10*o.duration,value:10*o.currentTime,onInput:a[6]||(a[6]=e=>u.updateTime(e/10))},null,8,["disabled","length","value"])])],2)};const _={components:{Subtitle:X,Controls:q},mixins:[g,b],props:{currentTime:{type:Number,default:0}},emits:["stop","update:currentTime"],data:()=>({allCues:[],activeCues:[],isPaused:!1,duration:0,started:!1}),computed:{movieSrc(){return URL.createObjectURL(this.movie)},subtitleSrc(){return URL.createObjectURL(this.subtitle)}},mounted(){this.updateTime(this.currentTime),this.started=!0},methods:{onSubtitleTrackLoad(e){this.allCues=Object.freeze([...e.target.track.cues])},onCueChange(e){const t=Object.freeze([...e.target.track.activeCues]);this.activeCues=t},onTimeUpdate(e){this.started&&this.$emit("update:currentTime",e)},onPlay(){const{player:e}=this.$refs;this.duration=e.duration,this.isPaused=!1},onPause(){this.isPaused=!0},stop(){this.$emit("stop")},togglePlay(){const{player:e}=this.$refs;e.paused?e.play():e.pause()},updateTime(e){const{player:t}=this.$refs;t.currentTime=e}},style:({className:e})=>[e("player",{width:"100%",height:"100%",maxHeight:"100%",background:"#000","&::cue":{opacity:0}}),e("subtitle",{position:"absolute",bottom:"120px"}),e("controls",{position:"absolute",bottom:0})]};_.render=function(s,a,o,l,r,u){const d=n("Subtitle"),c=n("Controls");return e(),t("div",null,[i("video",{ref:"player",class:s.$style.player,autoplay:"",onPlay:a[3]||(a[3]=(...e)=>u.onPlay&&u.onPlay(...e)),onPause:a[4]||(a[4]=(...e)=>u.onPause&&u.onPause(...e)),onTimeupdate:a[5]||(a[5]=e=>u.onTimeUpdate(e.target.currentTime))},[i("source",{src:u.movieSrc,type:"video/mp4"},null,8,["src"]),i("track",{ref:"subtitleTrack",kind:"subtitles",label:"Subtitle",default:"",src:u.subtitleSrc,onLoad:a[1]||(a[1]=(...e)=>u.onSubtitleTrackLoad&&u.onSubtitleTrackLoad(...e)),onCuechange:a[2]||(a[2]=(...e)=>u.onCueChange&&u.onCueChange(...e))},null,40,["src"])],34),i(d,{class:s.$style.subtitle,"active-cues":r.activeCues,"subtitle-lang":s.subtitleLang,"primary-lang":s.primaryLang,"translator-service":s.translatorService},null,8,["class","active-cues","subtitle-lang","primary-lang","translator-service"]),i(c,{class:s.$style.controls,"all-cues":r.allCues,"active-cues":r.activeCues,"is-paused":r.isPaused,"current-time":o.currentTime,duration:r.duration,onTogglePlay:u.togglePlay,onUpdateTime:u.updateTime,onStop:u.stop},null,8,["class","all-cues","active-cues","is-paused","current-time","duration","onTogglePlay","onUpdateTime","onStop"])])};const ee={components:{Config:f,Player:_},data:()=>({movie:void 0,subtitle:void 0,subtitleLang:void 0,primaryLang:void 0,translatorService:void 0,isPlaying:!1,playerCurrentTime:0}),methods:{togglePlay(){this.isPlaying=!this.isPlaying}},style:({className:e})=>[e("home",{width:"100%",height:"100%",maxHeight:"100%"})]};ee.render=function(s,a,o,c,p,m){const g=n("Config"),h=n("Player");return e(),t(d,null,[l(i(g,{movie:p.movie,"onUpdate:movie":a[1]||(a[1]=e=>p.movie=e),subtitle:p.subtitle,"onUpdate:subtitle":a[2]||(a[2]=e=>p.subtitle=e),"subtitle-lang":p.subtitleLang,"onUpdate:subtitle-lang":a[3]||(a[3]=e=>p.subtitleLang=e),"primary-lang":p.primaryLang,"onUpdate:primary-lang":a[4]||(a[4]=e=>p.primaryLang=e),"translator-service":p.translatorService,"onUpdate:translator-service":a[5]||(a[5]=e=>p.translatorService=e),class:s.$style.home,onDone:m.togglePlay},null,8,["movie","subtitle","subtitle-lang","primary-lang","translator-service","class","onDone"]),[[r,!p.isPlaying]]),p.isPlaying?(e(),t(h,{key:0,"current-time":p.playerCurrentTime,"onUpdate:current-time":a[6]||(a[6]=e=>p.playerCurrentTime=e),class:s.$style.home,movie:p.movie,subtitle:p.subtitle,"subtitle-lang":p.subtitleLang,"primary-lang":p.primaryLang,"translator-service":p.translatorService,onStop:m.togglePlay},null,8,["current-time","class","movie","subtitle","subtitle-lang","primary-lang","translator-service","onStop"])):u("",!0)],64)};const te={components:{Home:ee},style:({className:e,custom:t})=>[e("app",{width:"100%",height:"100%",overflow:"hidden"}),t("html, body, #app",{fontFamily:"sans-serif",width:"100%",height:"100%",minHeight:"100%",maxWidth:"100%"}),t("*, *:after, &:before",{bixSizing:"content-box",touchAction:"none !important"}),t("*",{touchAction:"none !important",userSelect:"none",fontFamily:"inherit",padding:0,margin:0,listStyle:"none",borderStyle:"solid",borderWidth:"0px",verticalAlign:"baseline",backfaceVisibility:"hidden",color:"inherit",borderColor:"inherit",backgroundColor:"transparent",borderSpacing:0,font:"unset","-webkitOverflowScrolling":"touch","-webkitTapHighlightColor":"rgba(0, 0, 0, 0)",boxSizing:"border-box","&::-moz-focus-inner":{border:0},"&:focus":{outline:"none"}}),t("a, a:hover, a:visited",{textDecoration:"none"})]};te.render=function(s,a,o,l,r,u){const d=n("Home");return e(),t("div",{class:s.$style.app},[i(d)],2)};window.$app=c(te).use(p).mount("#app");
